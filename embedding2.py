from openai import OpenAI
import os
import pickle

# Upstage Solar API 클라이언트 설정
client = OpenAI(
    api_key="up_MixgDl0HXpwJm7THloh2OjKIH1T8m",  # 환경변수에서 가져오기
    base_url="https://api.upstage.ai/v1/solar"
)

print("🔄 Upstage Solar API 클라이언트 설정 완료")
print(f"   API Key: {os.getenv('up_MixgDl0HXpwJm7THloh2OjKIH1T8m', 'NOT SET')[:20]}...")
# 서안개발 및 금하빌딩 정보 청크
article_chunks = [
    # ============================================================
    # 서안개발 정보
    # ============================================================
    
    # CHUNK 1: 서안개발 기본 정보 + 연혁
    """서안개발주식회사 기본 정보:

회사명: 서안개발주식회사 (SUHAN DEVELOPMENT CO., LTD)
설립일: 1991년 7월 1일
본점 주소: 서울특별시 강남구 학동로 401 (청담동 41-2, 금하빌딩)
주요 사업: 부동산 임대 및 관리 (부동산임대, 시설관리, 컨설팅)

연혁:
- 1991년: 서안개발주식회사 설립
- 2021년: 창립 30주년 달성
- 2025년: 현재 안정적 부동산 자산 운영 중""",
    
    # CHUNK 2: 서안개발 핵심 역량
    """서안개발주식회사의 핵심 역량:

30년 이상의 노하우로 강남권 중심의 부동산 임대 및 관리 사업을 안정적으로 운영하고 있습니다.
자가 보유 부동산인 금하빌딩을 기반으로 안정적인 수익을 창출하고 있습니다.
입주사와의 견고한 관계를 바탕으로 지속 가능한 성장을 추구하고 있습니다.
"공간을 넘어 자산가치를 설계하는 기업"이라는 비전을 실현하고 있습니다.""",
    
    # ============================================================
    # 금하빌딩 기본 정보
    # ============================================================
    
    # CHUNK 3: 금하빌딩 기본 정보
    """금하빌딩 기본 정보:

건물명: 금하빌딩
소재지: 서울특별시 강남구 학동로 401 (청담동 41-2)

건축 정보:
- 대지면적: 2,716.2㎡ (821.65평)
- 연면적: 36,392.99㎡ (11,008.83평)
- 용도: 업무시설
- 시설구분: 일반업무시설
- 층수: 지상 18층, 지하 7층
- 주차: 총 222대 수용 가능
- 주차면적: 유효주차 면대당 50.95㎡ (1대당 약 20평, VAT별도)""",
    
    # ============================================================
    # 금하빌딩 교통 및 위치
    # ============================================================
    
    # CHUNK 4: 금하빌딩 위치 및 교통
    """금하빌딩 위치 및 교통 정보:

주소: 서울특별시 강남구 학동로 401 (청담동 41-2, 금하빌딩)

지하철 접근성:
- 강남구청역 (수인분당선, 7호선) 4번 출구 도보 약 1분 거리
- 매우 편리한 대중교통 접근성

버스 :
청담동래미안아파트 1분

차량 진출입 : 
지주식 지상/지하추자장 진입 용이함(램프식 지하주차장)

주변 환경:
- 강남구청 인접 (70.5m 거리)
- 강남 핵심 업무지구 위치
- 노선 접근성: 7호선, 수인분당선 이용 가능

주차 시설:
- 지하 2층~7층 주차장
- 총 222대 주차 가능
- 24시간 이용 가능""",
    
    # ============================================================
    # 금하빌딩 임대 정보
    # ============================================================
    
    # CHUNK 5: 금하빌딩 임대 조건
    """금하빌딩 임대 조건:

임대 정보 CHUNK ① — 11층 (일부)
금하빌딩11층은효율적인공간활용이가능한사무실을제공합니다. 
넓은전용면적(143.28평)을통해다양한레이아웃구성이가능하며, 쾌적한업무환경을조성할수있습니다.
해당층: 11층 (일부)
-임대면적: 286.56평
-전용면적: 143.28평
-보증금: 3억 5,000만원
-임대료: 2,579만 400원
-관리비: 1,289만 5,200원
-NOC (평당 비용): 270,000원
-입주시기: 2026년 1월 (11층 (일부) → 2025년 12월 말 종료 예정)""",

    """
    임대 정보 CHUNK ② — 17층
하빌딩17층은전용테라스가있어뛰어난조망권을자랑하는프리미엄사무실입니다. 
전용면적137평으로, 2025년12월중순부터내부공사착수가가능합니다
해당층: 17층
-임대면적: 274평
-전용면적: 137평
-보증금: 2억 7,400만원
-임대료: 2,466만원
-관리비: 1,233만원
-NOC (평당 비용): 270,000원
-입주시기: 2026년 1월(2025년 12월 중순 내부공사 착수 가능)""",

"""
주차 조건:
- 기본 주차: 입대면적 50평당 1대 무상
- 추가 주차: 대당 200,000원/월
- 17층 유효주차 시설 가능 (테라스 보유)

참고사항:
- 2025년 10월 기준 정보
- 실제 임대 조건은 층별, 면적별로 상이할 수 있음
- 상세 조건은 문의 필요""",
    
    # ============================================================
    # 금하빌딩 층별 현황
    # ============================================================
    
    # CHUNK 6: 금하빌딩 층별 임대 현황
    """금하빌딩 층별 임대 현황 (2025년 10월 기준):

금하빌딩 층별 임대 현황 (2025년 10월 기준)

17F : 공실
16F : 콘메드코리아
15F : 신원종합개발
14F : 한국마즈
13F : 니프코코리아
12F : 한국바이린
11F : 공실 / DMC미디어
10F : 로얄캐닌
09F : (주)인스코비
08F : (주)엔텔스
07F : (주)엔텔스
06F : (주)대농
05F : DMC미디어
04F : 법무법인 정률
03F : 더스킨팩토리
02F : 한국투자증권, 골든블루, KB손해보험
01F : 우리은행, 풀바셋
B1F : 식당, 카페, 법무법인 창, 서안개발
B2F~B7F : 주차장, 기계실

공실 층:
- 17층: 현재 임대 가능
- 11층: 일부 공실 (DMC 미디어와 공유)""",
    
    # ============================================================
    # 금하빌딩 문의 정보
    # ============================================================
    
    # CHUNK 7: 금하빌딩 임대 문의
    """금하빌딩 임대 문의 안내:

문의 내용:
금하빌딩 사무실 임대에 대한 공급 안내 및 관련 문의 사항을 전문 담당자가 친절하게 안내해드립니다.
전문 컨설턴트가 전직할가 인 전적시개 안내드립니다.

상담 가능 시간:
- 평일: 09:00 - 18:00
- 긴급 문의: 24시간 이메일 접수

담당자 연락처:
1) 담당자: Ryan
   - 전화: 010-6661-1793
   - 이메일: Ryan@suhan.co.kr

2) 담당자: (추가 담당자)
   - 전화: 010-6580-5464
   - 이메일: Ryan@suhan.co.kr

문의 방법:
- 전화 상담 (평일 09:00-18:00)
- 이메일 문의 (24시간)
- 방문 상담 (사전 예약 필요)

문의 시 안내 사항:
- 희망 입주 시기
- 필요 면적 (평수)
- 예산 범위
- 주차 대수 필요 여부
- 기타 요구사항""",
    
    # ============================================================
    # 금하빌딩 특징 및 장점
    # ============================================================
    
    # CHUNK 8: 금하빌딩 특징 및 장점
"""금하빌딩의 특징 및 장점:

입지 특징:
- 강남구청역 도보 1분 초역세권
- 강남 핵심 업무지구 위치
- 7호선, 수인분당선 더블역세권
- 강남구청 인접으로 행정 업무 편리

건물 특징:
- 지상 17층 규모의 중대형 오피스
- 넉넉한 주차 공간 (222대)
- 층고 7.4m의 쾌적한 사무 환경
- 엘리베이터 및 편의시설 완비

관리 특징:
- 서안개발 직접 운영 관리
- 30년 이상의 건물 관리 노하우
- 안정적인 임대 운영
- 입주사 맞춤 서비스 제공""",
]


print(f"\n📝 총 {len(article_chunks)}개의 청크 준비 완료")
print("\n🔄 Solar Embedding API를 사용하여 임베딩 생성 중...")

# Solar Embedding API를 사용하여 각 청크에 대한 임베딩 생성
chunk_embeddings = []

for i, chunk in enumerate(article_chunks, 1):
    try:
        print(f"   처리 중: Chunk {i}/{len(article_chunks)}...", end=" ")
        
        embedding = client.embeddings.create(
            input=chunk, 
            model="solar-embedding-1-large-passage"  # Solar 임베딩 모델 (문서용, 4096 차원)
        ).data[0].embedding
        
        chunk_embeddings.append(embedding)
        print(f"✅ 완료 (차원: {len(embedding)})")
        
    except Exception as e:
        print(f"❌ 실패")
        print(f"   에러: {e}")
        raise

# 임베딩 데이터를 pickle 파일로 저장
print("\n💾 embeddings.pkl 파일로 저장 중...")

with open("embeddings.pkl", "wb") as f:
    pickle.dump({
        "chunks": article_chunks, 
        "embeddings": chunk_embeddings
    }, f)

print("\n" + "="*70)
print("✅ 성공적으로 완료!")
print("="*70)
print(f"📊 청크 개수: {len(article_chunks)}")
print(f"📊 임베딩 차원: {len(chunk_embeddings[0])}")
print(f"📊 파일 크기: {os.path.getsize('embeddings.pkl') / 1024:.2f} KB")
print("="*70)
print("\n💡 다음 단계:")
print("   1. embeddings.pkl 파일을 프로젝트 루트에 배치")
print("   2. main.py와 함께 Git에 커밋")
print("   3. Render에 배포")
print("\n🔑 필요한 환경변수:")
print("   - UPSTAGE_API_KEY (이미 사용 중)")
print("   - OPENAI_API_KEY는 필요 없음! (Solar만 사용)")
